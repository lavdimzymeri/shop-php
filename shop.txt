<?php

// establish database connection
$conn = new mysqli($servername, $username, $password);

// create a new shop in the database
function create_shop($name, $address) {
  global $db;
  $stmt = $db->prepare("INSERT INTO shops (name, address) VALUES (?, ?)");
  $stmt->execute([$name, $address]);
}

// update an existing shop in the database
function update_shop($id, $name, $address) {
  global $db;
  $stmt = $db->prepare("UPDATE shops SET name = ?, address = ? WHERE id = ?");
  $stmt->execute([$name, $address, $id]);
}

// retrieve a list of all shops from the database
function get_all_shops() {
  global $db;
  $stmt = $db->prepare("SELECT * FROM shops");
  $stmt->execute();
  return $stmt->fetchAll(PDO::FETCH_ASSOC);
}

// retrieve a specific shop from the database by ID
function get_shop_by_id($id) {
  global $db;
  $stmt = $db->prepare("SELECT * FROM shops WHERE id = ?");
  $stmt->execute([$id]);
  return $stmt->fetch(PDO::FETCH_ASSOC);
}

// check if a shop exists in the database by name and address
function shop_exists($name, $address) {
  global $db;
  $stmt = $db->prepare("SELECT COUNT(*) FROM shops WHERE name = ? AND address = ?");
  $stmt->execute([$name, $address]);
  return ($stmt->fetchColumn() > 0);
}

// check if a shop exists in the database by ID
function shop_exists_by_id($id) {
  global $db;
  $stmt = $db->prepare("SELECT COUNT(*) FROM shops WHERE id = ?");
  $stmt->execute([$id]);
  return ($stmt->fetchColumn() > 0);
}

// add or update a shop in the database
if ($_SERVER['REQUEST_METHOD'] == 'POST') {
  if (isset($_POST['add_shop'])) {
    $name = $_POST['name'];
    $address = $_POST['address'];
    if (!shop_exists($name, $address)) {
      create_shop($name, $address);
      echo "Shop added successfully!";
    } else {
      echo "Shop already exists!";
    }
  } else if (isset($_POST['edit_shop'])) {
    $id = $_POST['id'];
    $name = $_POST['name'];
    $address = $_POST['address'];
    if (shop_exists_by_id($id)) {
      update_shop($id, $name, $address);
      echo "Shop updated successfully!";
    } else {
      echo "Shop not found!";
    }
  }
}

// display a form for adding a new shop
function display_add_shop_form() {
  echo '<h2>Add Shop</h2>';
  echo '<form method="POST">';
  echo '<label for="name">Shop Name:</label>';
  echo '<input type="text" id="name" name="name" required>';
  echo '<br>';
  echo '<label for="address">Shop Address:</label>';
  echo '<input type="text" id="address" name="address" required>';
  echo '<br>';
  echo '<button type="submit" name="add_shop">Add Shop</button>';
  echo '</form>';
}

